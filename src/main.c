#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <getopt.h>
#include "common.h"
#include "core.h"
#include "utils.h"
#include "loadNet.h"
#include "net.h"
#include "string.h"

typedef enum command{
    DEFAULT=0,
    RUN,
    PARSE,
    LOAD,
    TEST,
    DECODER,
    INFERENCE,
    PRINT,
    CMD_NUM,
}command_t;

void print_help() {
    printf("Usage: program_name [options]\n");
    printf("Options:\n");
    printf("  -R, --run             Run model inference\n");
    printf("  -P, --parse           Parse json file in list tjpg_RBGle\n");
    printf("  -L, --load            Load .ml file in list tjpg_RBGle\n");
    printf("  -p, --print           Parse json file in list tjpg_RBGle\n");
    printf("  -T, --test            Internal test use\n");
    printf("  -D, --decoder         Internal test use\n");
    printf("  -I, --inference       model inference test\n");
    printf("  -h, --help            Show help information\n");
    printf("  -o, --output <file>   Output file name\n");
    printf("  -m, --model <model>   The model to run\n");
    printf("  -f, --file <file>     Specify the input file\n");
    printf("  -n, --name <string>   Specify a name\n");
}

uint8_t picture_RGB[1][3][32][32] =
{
	{
		{
			{0x10, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x14, 0x14, 0x2d, 0x3b, 0x24, 0x1d, 0x1c, 0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, },
			{0x14, 0x12, 0x13, 0x13, 0x12, 0x14, 0x14, 0x2d, 0x3b, 0x24, 0x1d, 0x1c, 0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, },
			{0x13, 0x12, 0x14, 0x14, 0x2d, 0x3b, 0x24, 0x1d, 0x1c, 0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, },
			{0x14, 0x2d, 0x3b, 0x24, 0x1d, 0x1c, 0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, },
			{0x24, 0x1d, 0x1c, 0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, },
			{0x18, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, },
			{0x20, 0x22, 0x24, 0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, },
			{0x24, 0x22, 0x20, 0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, },
			{0x20, 0x20, 0x1b, 0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, },
			{0x20, 0x27, 0x29, 0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, },
			{0x26, 0x29, 0x11, 0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, },
			{0x12, 0x15, 0x14, 0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, },
			{0x12, 0x13, 0x13, 0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, },
			{0x12, 0x12, 0x19, 0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, },
			{0x66, 0x96, 0x4f, 0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, },
			{0x1e, 0x1f, 0x1c, 0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, },
			{0x21, 0x24, 0x25, 0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, },
			{0x24, 0x23, 0x22, 0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, },
			{0x22, 0x23, 0x21, 0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, },
			{0x23, 0x1e, 0x1e, 0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, },
			{0x1b, 0x21, 0x2b, 0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, },
			{0x27, 0x11, 0x12, 0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, },
			{0x15, 0x14, 0x12, 0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, },
			{0x14, 0x14, 0x12, 0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, },
			{0x14, 0x21, 0x82, 0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, },
			{0xa7, 0x82, 0x34, 0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, },
			{0x20, 0x22, 0x21, 0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, },
			{0x23, 0x26, 0x26, 0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, },
			{0x25, 0x23, 0x24, 0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, },
			{0x24, 0x24, 0x1e, 0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, },
			{0x1c, 0x21, 0x1f, 0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, },
			{0x1e, 0x23, 0x26, 0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, },
		},
		{
			{0x12, 0x13, 0x15, 0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, },
			{0x14, 0x13, 0x13, 0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, },
			{0x14, 0x12, 0x12, 0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, },
			{0x26, 0x95, 0xb2, 0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, },
			{0x93, 0x5b, 0x29, 0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, },
			{0x26, 0x22, 0x22, 0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, },
			{0x25, 0x25, 0x25, 0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, },
			{0x25, 0x23, 0x22, 0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, },
			{0x20, 0x24, 0x23, 0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, },
			{0x1b, 0x1a, 0x1e, 0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, },
			{0x1c, 0x23, 0x14, 0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, },
			{0x14, 0x16, 0x15, 0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, },
			{0x12, 0x14, 0x14, 0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, },
			{0x12, 0x13, 0x2f, 0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, },
			{0xb2, 0xd0, 0xa6, 0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, },
			{0x74, 0x3c, 0x24, 0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, },
			{0x27, 0x26, 0x25, 0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, },
			{0x25, 0x25, 0x24, 0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, },
			{0x24, 0x23, 0x23, 0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, },
			{0x23, 0x1e, 0x26, 0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, },
			{0x22, 0x1c, 0x18, 0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, },
			{0x1a, 0x14, 0x15, 0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, },
			{0x16, 0x15, 0x13, 0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, },
			{0x14, 0x14, 0x12, 0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, },
			{0x12, 0x39, 0xb9, 0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, },
			{0xd7, 0xbb, 0x8a, 0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, },
			{0x53, 0x26, 0x24, 0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, },
			{0x25, 0x27, 0x28, 0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, },
			{0x27, 0x25, 0x24, 0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, },
			{0x24, 0x25, 0x22, 0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, },
			{0x32, 0x64, 0x46, 0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, },
			{0x1e, 0x1c, 0x1b, 0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, },
		},
		{
			{0x15, 0x16, 0x17, 0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, },
			{0x16, 0x13, 0x15, 0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, },
			{0x14, 0x12, 0x0f, 0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, },
			{0x37, 0xb7, 0xe1, 0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, },
			{0xbe, 0x9c, 0x6d, 0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, },
			{0x39, 0x27, 0x27, 0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, },
			{0x28, 0x28, 0x29, 0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, },
			{0x27, 0x25, 0x24, 0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, },
			{0x22, 0x3e, 0x69, 0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, },
			{0x8b, 0x43, 0x19, 0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, },
			{0x1c, 0x19, 0x16, 0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, },
			{0x16, 0x17, 0x16, 0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, },
			{0x14, 0x15, 0x15, 0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, },
			{0x13, 0x16, 0x35, 0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, },
			{0xbc, 0xdc, 0xc7, 0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, },
			{0x9d, 0x7a, 0x5a, 0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, },
			{0x36, 0x2d, 0x25, 0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, },
			{0x22, 0x25, 0x27, 0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, },
			{0x26, 0x24, 0x42, 0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, },
			{0x6e, 0x94, 0x87, 0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, },
			{0x2c, 0x1b, 0x1b, 0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, },
			{0x1a, 0x17, 0x13, 0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, },
			{0x17, 0x15, 0x13, 0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, },
			{0x18, 0x16, 0x15, 0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, },
			{0x12, 0x46, 0xbe, 0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, },
			{0xcc, 0xc9, 0xa5, 0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, },
			{0x75, 0x66, 0x53, 0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, },
			{0x40, 0x23, 0x24, 0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, 0x86, 0x73, 0x65, },
			{0x2f, 0x3c, 0x3a, 0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, 0x86, 0x73, 0x65, 0x50, 0x37, 0x41, },
			{0x49, 0x7c, 0x8f, 0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, 0x86, 0x73, 0x65, 0x50, 0x37, 0x41, 0x59, 0x4d, 0x5a, },
			{0xbb, 0x6c, 0x19, 0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, 0x86, 0x73, 0x65, 0x50, 0x37, 0x41, 0x59, 0x4d, 0x5a, 0x76, 0x8d, 0xaa, },
			{0x1e, 0x1e, 0x19, 0x18, 0x14, 0x18, 0x16, 0x13, 0x18, 0x15, 0x14, 0x17, 0x58, 0xb0, 0xc6, 0xb1, 0x94, 0x86, 0x73, 0x65, 0x50, 0x37, 0x41, 0x59, 0x4d, 0x5a, 0x76, 0x8d, 0xaa, 0xbc, 0x52, 0x1f, },
		},
	},
};
data_info_t jpg_RGB = {
    .dim = {1, 3, 32, 32},
    .len = ONE_BYTE,
};

void print_rgb_pixel(uint16_t dim, uint8_t depth) {
  
    switch(dim){
        case 0:
            printf("\033[48;2;%d;0;0m%02x ", depth, depth);
            break;
        case 1:
            printf("\033[48;2;0;%d;0m%02x ", depth, depth);
            break;
        case 2:
            printf("\033[48;2;0;0;%dm%02x ", depth, depth);
            break;
        default:break;
    }
    
}

data_info_t * jpg_decoder_test(char *name){
    data_info_t *jpg_RBG = malloc(sizeof(data_info_t));
            
    jpg_decode(name, jpg_RBG);
    uint8_t (*data)[jpg_RBG->dim[2]][jpg_RBG->dim[3]] = jpg_RBG->data;
    printf("\n");
    
    for(uint16_t dim2=0; dim2<jpg_RBG->dim[2];dim2++){
        for(uint16_t dim1=0; dim1<2;dim1++){
            for(uint16_t dim3=0; dim3<jpg_RBG->dim[3];dim3++){
                print_rgb_pixel(dim1, data[dim1][dim2][dim3]);
            }
        }
        printf("\033[48;2;255;255;255m  \n");
    }
    for(uint16_t dim2=0; dim2<jpg_RBG->dim[2];dim2++){
        for(uint16_t dim1=2; dim1<4;dim1++){
            if(dim1 < 3)
                for(uint16_t dim3=0; dim3<jpg_RBG->dim[3];dim3++){
                    print_rgb_pixel(dim1, data[dim1][dim2][dim3]);
                }
            else 
                for(uint16_t dim3=0; dim3<jpg_RBG->dim[3];dim3++){
                    printf("\033[48;2;%d;%d;%dm   ",data[0][dim2][dim3], data[1][dim2][dim3], data[2][dim2][dim3]);
            }
        }
        printf("\033[48;2;0;0;0m  \n");
    }

    return jpg_RBG;
}

int main(int argc, char *argv[]) {
    int opt;
    char *file = NULL, *model = NULL, *output = NULL, *name = NULL;
    int number = 0;
    command_t cmd;

    // 定义长选项
    static struct option long_options[] = {
        {"run", no_argument, 0, 'R'},
        {"parse", no_argument, 0, 'P'},
        {"load", no_argument, 0, 'L'},
        {"print", no_argument, 0, 'p'},
        {"test", no_argument, 0, 'T'},
        {"decoder", no_argument, 0, 'D'},
        {"inference", no_argument, 0, 'I'},
        {"model", required_argument, 0, 'm'},
        {"output", required_argument, 0, 'o'},
        {"file", required_argument, 0, 'f'},
        {"name", required_argument, 0, 'n'},
        {"help", no_argument,       0, 'h'},
        {0, 0, 0, 0}  // 结束标志
    };

    // 解析命令行参数
    while ((opt = getopt_long(argc, argv, "RPTDLIpo:f:m:n:h", long_options, NULL)) != -1) {
        switch (opt) {
            case 'R':cmd = RUN;
                    break;
            case 'P':cmd = PARSE;
                    break;
            case 'T':cmd = TEST;
                    break;
            case 'D':cmd = DECODER;
                    break;
            case 'I':cmd = INFERENCE;
                    break;
            case 'L':cmd = LOAD;
                    break;
            case 'p':cmd = PRINT;
                    break;
            case 'o':
                output = optarg;
                break;
            case 'f':
                file = optarg;
                break;
            case 'm':
                model = optarg;
                break;
            case 'n':
                name = optarg;
                break;
            case '?':eprint("arguments error!\n");
            case 'h':
            default:
                print_help();
                return 0;
        }
    }

    switch(cmd){
        case RUN:break;
        case PARSE:
            if(!file){
                eprint("file arguments error!\n");
                print_help();
                return -1;
            }
            
            if(!output)
                output = "model.ml";
            json_model_parse_v2(file);
            // NetStorage(json_model_parse(file), NULL, NULL, NULL, output);
            break;
        case TEST:
            extern void BConvTest();
            BConvTest();
            break;
        case DECODER:
            if(!file){
                eprint("file arguments error!\n");
                print_help();
                return -1;
            }
            jpg_decoder_test(file);
            break;
        case INFERENCE:
            if(!file || !model){
                eprint("file arguments error!%d,%d\n",file==0,model==0);
                print_help();
                return -1;
            }
            data_info_t *input = malloc(sizeof(data_info_t));
            memcpy( input, &jpg_RGB,sizeof(data_info_t));
            void *jpg_data = malloc(sizeof(uint8_t)*input->dim[0]*input->dim[1]*input->dim[2]*input->dim[3]);
            memcpy( jpg_data, &picture_RGB,sizeof(uint8_t)*input->dim[0]*input->dim[1]*input->dim[2]*input->dim[3]);
            input->data = jpg_data;
            load_ml_net(model);
            resnet18(jpg_decoder_test(file));
            free_net((common_t**)&Net);
            break;
        case PRINT:
            load_ml_net(file);
            printf_appoint_data(name, (common_t*)Net);
            free_net((common_t**)&Net);
            break;
        case LOAD:
            load_ml_net(file);
            printf_net_structure((common_t*)Net);
            printf_appoint_data(name, (common_t*)Net);
            free_net((common_t**)&Net);
            break;
        default:
        print_help();
            return -1;
    }

    return 0;
}
